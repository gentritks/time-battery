<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time & Battery</title>
  <meta name="description" content="Large clock with battery status and class countdowns." />
  <style>
    :root{
      --bg:#0b0f14; --fg:#e6eef7; --muted:#9db0c0;
      --ok:#29c759; --warn:#f5a524; --crit:#ff3b30; --accent:#4da3ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      display:flex;align-items:center;justify-content:center;padding:4vh 4vw;
    }
    .wrap{width:min(1100px,100%);text-align:center}
    .time{font-weight:700;letter-spacing:.02em;line-height:1}
    .time .clock{font-size:clamp(48px,16vw,160px)}
    .time .date{margin-top:.4rem;font-size:clamp(18px,3.8vw,28px);color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:22px;margin-top:36px}
    @media (min-width:700px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:#101722;border:1px solid #1b2330;border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .label{text-transform:uppercase;font-size:12px;letter-spacing:.14em;color:var(--muted);margin-bottom:8px}
    /* Battery */
    .battery{margin-inline:auto;width:clamp(240px,40vw,420px);height:120px;position:relative;display:flex;align-items:center;justify-content:center}
    .battery svg{width:100%;height:100%;display:block}
    .percent{font-size:clamp(24px,4.2vw,40px);font-weight:700}
    .status{margin-top:4px;color:var(--muted);font-size:14px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    /* Countdowns */
    .countdown-item{margin:6px 0;font-size:16px;line-height:1.6}
    .countdown-item strong{color:var(--accent)}
    .footer{margin-top:28px;color:var(--muted);font-size:12px;opacity:.85}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .hidden{display:none!important}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <section class="time" aria-live="polite">
      <div class="clock" id="clock">--:--:--</div>
      <div class="date" id="date">Loading date…</div>
    </section>

    <section class="grid" aria-live="polite">
      <!-- Battery -->
      <div class="card">
        <div class="label">Battery</div>
        <div class="battery" aria-label="Battery" role="img">
          <svg viewBox="0 0 520 240" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="10" y="40" width="470" height="160" rx="24" fill="#0c1520" stroke="#273449" stroke-width="8"/>
            <rect x="490" y="85" width="20" height="70" rx="8" fill="#273449"/>
            <clipPath id="clip"><rect x="18" y="48" width="454" height="144" rx="16"/></clipPath>
            <g clip-path="url(#clip)">
              <rect x="18" y="48" width="454" height="144" fill="#132033"/>
              <rect id="fill" x="18" y="48" width="0" height="144" fill="#29c759"/>
            </g>
            <path id="bolt" class="hidden" d="M270 65 l-50 70 h40 l-20 70 l70 -95 h-40 l20 -45 z" fill="#ffffff" opacity=".9"/>
          </svg>
        </div>
        <div class="percent" id="percent">—%</div>
        <div class="status" id="bStatus">Detecting battery…</div>
        <div class="status hidden" id="unsupported">Battery status isn’t available on this device or in this browser.</div>
        <div class="sr-only" id="srBattery" aria-live="polite"></div>
      </div>

      <!-- Class Countdowns -->
      <div class="card">
        <div class="label">Class Countdowns</div>
        <div id="countdowns">
          <div class="countdown-item">Initializing…</div>
        </div>
      </div>
    </section>

    <div class="footer">Tip: Bookmark this page so you can quickly check your battery and class times in kiosk mode.</div>
  </main>

  <script>
    (function(){
      // ------- Clock (device time; simple + offline-friendly) -------
      const clockEl = document.getElementById('clock');
      const dateEl  = document.getElementById('date');
      function safeFormatter(opts){ try { return new Intl.DateTimeFormat(undefined, opts); } catch(_) { return null; } }
      const fmtTime = safeFormatter({hour:'2-digit', minute:'2-digit', second:'2-digit'});
      const fmtDate = safeFormatter({weekday:'long', year:'numeric', month:'long', day:'numeric'});
      function tickClock(){
        const now = new Date();
        clockEl.textContent = fmtTime ? fmtTime.format(now) : now.toLocaleTimeString();
        dateEl.textContent  = fmtDate ? fmtDate.format(now) : now.toLocaleDateString();
      }
      tickClock();
      setInterval(tickClock, 1000);

      // ------- Battery (robust; handles missing/never-resolving API) -------
      const fillEl        = document.getElementById('fill');
      const percentEl     = document.getElementById('percent');
      const statusEl      = document.getElementById('bStatus');
      const unsupportedEl = document.getElementById('unsupported');
      const srBattery     = document.getElementById('srBattery');
      const boltEl        = document.getElementById('bolt');

      function setFill(pct){
        const w = Math.max(0, Math.min(454 * (pct/100), 454));
        fillEl.setAttribute('width', w);
        let varName = '--ok';
        if (pct <= 20) varName = '--crit';
        else if (pct <= 40) varName = '--warn';
        const color = getComputedStyle(document.documentElement).getPropertyValue(varName) || '#29c759';
        fillEl.setAttribute('fill', color.trim());
      }
      function humanTime(sec){
        if (!isFinite(sec) || sec < 0) return '—';
        const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60);
        return (h>0 ? h+'h ' : '') + m + 'm';
      }
      async function initBattery(){
        if (!('getBattery' in navigator)) {
          unsupportedEl.classList.remove('hidden');
          statusEl.classList.add('hidden');
          return;
        }
        let rendered = false;
        const watchdog = setTimeout(() => {
          if (!rendered) {
            unsupportedEl.classList.remove('hidden');
            statusEl.classList.add('hidden');
          }
        }, 5000); // if promise never resolves

        try {
          const battery = await navigator.getBattery();
          function render(){
            rendered = true;
            const pct = Math.round(battery.level * 100);
            percentEl.textContent = pct + '%';
            setFill(pct);
            boltEl.classList.toggle('hidden', !battery.charging);
            const timeStr = battery.charging
              ? (battery.chargingTime === Infinity ? 'calculating…' : ('full in ' + humanTime(battery.chargingTime)))
              : (battery.dischargingTime === Infinity ? 'calculating…' : ('left ' + humanTime(battery.dischargingTime)));
            statusEl.textContent = (battery.charging ? 'Charging · ' : 'On battery · ') + timeStr;
            srBattery.textContent = `Battery ${pct} percent ${battery.charging ? 'and charging' : ''}`;
            unsupportedEl.classList.add('hidden');
            statusEl.classList.remove('hidden');
          }
          render();
          battery.addEventListener('levelchange', render);
          battery.addEventListener('chargingchange', render);
          battery.addEventListener('chargingtimechange', render);
          battery.addEventListener('dischargingtimechange', render);
        } catch (e) {
          console.error('Battery API error', e);
          unsupportedEl.classList.remove('hidden');
          statusEl.classList.add('hidden');
        } finally {
          clearTimeout(watchdog);
        }
      }
      initBattery();

      // ------- Class Countdowns (Mon–Thu vs Friday) -------
      const countdownsEl = document.getElementById('countdowns');
      const weekdaySchedule = [
        {name:'Homeroom', start:'08:00', end:'08:15'},
        {name:'1st Block', start:'08:20', end:'09:25'},
        {name:'2nd Block', start:'09:30', end:'10:35'},
        {name:'3rd Block', start:'10:40', end:'11:45'},
        {name:'4th Block', start:'11:45', end:'12:20'},
        {name:'5th Block', start:'12:25', end:'13:30'},
        {name:'6th Block', start:'13:35', end:'14:45'},
      ];
      const fridaySchedule = [
        {name:'Homeroom', start:'08:00', end:'08:15'},
        {name:'1st Block', start:'08:20', end:'09:25'},
        {name:'2nd Block', start:'09:30', end:'10:35'},
        {name:'3rd Block', start:'10:40', end:'11:35'}, // then school ends
      ];
      function parseHM(hm){
        const [H,M] = hm.split(':').map(Number);
        const d = new Date(); d.setHours(H, M, 0, 0); return d;
      }
      function humanClock(ms){
        if (ms <= 0) return '00:00';
        const t = Math.floor(ms/1000), h = Math.floor(t/3600), m = Math.floor((t%3600)/60), s = t%60;
        const pad = n => String(n).padStart(2,'0');
        return (h>0 ? pad(h)+':' : '') + pad(m)+':'+pad(s);
      }
      function updateCountdowns(){
        const now = new Date();
        const sched = (now.getDay() === 5) ? fridaySchedule : weekdaySchedule; // 0 Sun .. 6 Sat
        let active = null, next = null;
        for (let i=0;i<sched.length;i++){
          const s = parseHM(sched[i].start), e = parseHM(sched[i].end);
          if (now >= s && now < e) {
            active = { ...sched[i], s, e };
            next = sched[i+1] ? { ...sched[i+1], s: parseHM(sched[i+1].start) } : null;
            break;
          }
          if (now < s) { next = { ...sched[i], s }; break; }
        }
        let html = '';
        if (active){
          html += `<div class="countdown-item"><strong>${active.name}</strong> finishes in ${humanClock(active.e - now)}</div>`;
          if (next) html += `<div class="countdown-item">Next: ${next.name} at ${next.s.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
          else html += `<div class="countdown-item">School day ends after this block.</div>`;
        } else if (next){
          html += `<div class="countdown-item"><strong>${next.name}</strong> starts in ${humanClock(next.s - now)}</div>`;
          html += `<div class="countdown-item">Starts at ${next.s.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
        } else {
          html += `<div class="countdown-item">School day is over.</div>`;
        }
        countdownsEl.innerHTML = html;
      }
      updateCountdowns();
      setInterval(updateCountdowns, 1000);
    })();
  </script>
</body>
</html>
